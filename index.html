<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carbon Credit Dashboard</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>

    <!-- ── Login Screen ─────────────────────────────────────── -->
    <div id="login-wrapper" class="login-wrapper">
        <div id="login-page" class="login-container">
            <div class="logo-placeholder"><i class="bi bi-tree-fill"></i>Blue carbon ledger</div>
            <h2 class="text-center mb-4">Welcome Back</h2>
            <form id="login-form">
                <div class="mb-3">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" class="form-control" id="username" placeholder="e.g., 12345" required>
                </div>
                <div class="mb-4">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" placeholder="e.g., 12345" required>
                </div>
                <p id="login-message" class="text-center text-danger" style="display: none;"></p>
                <button type="submit" class="btn btn-primary w-100">
                    <i class="bi bi-box-arrow-in-right me-2"></i> Login
                </button>
            </form>
        </div>
    </div>

    <!-- ── Main App Layout ──────────────────────────────────── -->
    <div id="app-layout" style="display: none;">

        <!-- Sidebar -->
        <aside id="sidebar">
            <div>
                <div class="logo-placeholder"><i class="bi bi-tree-fill"></i> Blue carbon ledger</div>
                <div class="d-grid gap-2 sidebar-nav">
                    <button onclick="navigate('history-page'); displayDashboard();" class="btn btn-light text-start">
                        <i class="bi bi-grid-1x2-fill me-2"></i> Dashboard
                    </button>
                    <button onclick="navigate('company-page')" class="btn btn-light text-start">
                        <i class="bi bi-patch-plus-fill me-2"></i> New Calculation
                    </button>
                    <button onclick="navigate('transaction-page')" class="btn btn-light text-start">
                        <i class="bi bi-arrow-left-right me-2"></i> Transfer Credits
                    </button>
                    <button onclick="navigate('transaction-history-page'); displayTransactionHistory();"
                        class="btn btn-light text-start">
                        <i class="bi bi-clock-history me-2"></i> Transaction History
                    </button>
                    <button onclick="navigate('verified-data-page'); displayVerifiedData();"
                        class="btn btn-light text-start">
                        <i class="bi bi-shield-check me-2"></i> Plantation Data
                    </button>
                </div>
            </div>
            <div class="d-grid">
                <button onclick="logout()" class="btn btn-outline-danger">
                    <i class="bi bi-box-arrow-left me-2"></i> Logout
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main id="main-content">

            <!-- Company Details Page -->
            <div id="company-page" class="content-page" style="display: none;">
                <h2 class="mb-4">Company Details</h2>
                <p class="text-muted small">This is the first step for a new calculation.</p>
                <form id="company-form" class="mt-4">
                    <div class="mb-3">
                        <label for="company-name" class="form-label">Company Name</label>
                        <input type="text" class="form-control" id="company-name" placeholder="Enter company name"
                            required>
                    </div>
                    <div class="mb-4">
                        <label for="unique-code" class="form-label">Unique Company Code</label>
                        <input type="text" class="form-control" id="unique-code" placeholder="Enter unique code"
                            required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">
                        Continue <i class="bi bi-arrow-right-circle ms-2"></i>
                    </button>
                </form>
            </div>

            <!-- Calculate Footprint Page -->
            <div id="calculation-page" class="content-page" style="display: none;">
                <h2 class="mb-4">Calculate Footprint</h2>
                <form id="calculation-form">
                    <div class="mb-3">
                        <label for="electricity" class="form-label">Electricity Consumption (kWh/month)</label>
                        <input type="number" class="form-control" id="electricity" value="150" required>
                    </div>
                    <div class="mb-3">
                        <label for="transport" class="form-label">Transport Emissions (kg CO2e/year)</label>
                        <input type="number" class="form-control" id="transport" value="2000" required>
                    </div>
                    <div class="mb-4">
                        <label for="waste" class="form-label">Waste Generated (kg/month)</label>
                        <input type="number" class="form-control" id="waste" value="25" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-calculator-fill me-2"></i> Calculate Credits
                    </button>
                </form>
            </div>

            <!-- Connect Wallet Page -->
            <div id="metamask-page" class="content-page" style="display: none;">
                <h2 class="text-center mb-4">Connect Wallet</h2>
                <p class="text-center text-muted">Connect your wallet to process the carbon credit claim on the
                    blockchain.</p>
                <div class="d-flex justify-content-center align-items-center my-4">
                    <span id="metamask-status" class="metamask-status-indicator disconnected"></span>
                    <span id="metamask-text" class="fw-semibold">Not Connected</span>
                </div>
                <button id="connect-metamask-btn" class="btn btn-primary w-100 mb-3">
                    <i class="bi bi-wallet2 me-2"></i> Connect MetaMask
                </button>
                <button id="claim-credits-btn" class="btn btn-success w-100" disabled>
                    <i class="bi bi-patch-check-fill me-2"></i> Claim Credits
                </button>
                <p id="metamask-message" class="text-center mt-3" style="display: none;"></p>
                <button onclick="navigate('calculation-page')"
                    class="btn btn-outline-secondary w-100 mt-3">Back</button>
            </div>

            <!-- Result Page -->
            <div id="result-page" class="content-page" style="display: none;">
                <h2 class="text-center mb-2">Credits Calculated</h2>
                <div class="text-center my-4">
                    <p class="display-4 fw-bold mb-1" id="credit-value" style="color: var(--success-color);"></p>
                    <p class="text-muted">This value is based on your provided data.</p>
                </div>
                <button onclick="saveData()" class="btn btn-primary w-100 mb-3">
                    <i class="bi bi-save me-2"></i> Save and Finish
                </button>
                <button onclick="navigate('company-page')" class="btn btn-outline-secondary w-100">Start New
                    Calculation</button>
            </div>

            <!-- Dashboard Page -->
            <div id="history-page" class="content-page" style="display: none;">
                <h2 class="mb-4">Company Dashboard</h2>
                <div id="company-list" class="history-list-container"></div>
                <p id="dashboard-message" class="text-center text-muted mt-3" style="display: none;">No companies found
                    in the ledger.</p>
            </div>

            <!-- Transfer Credits Page -->
            <div id="transaction-page" class="content-page" style="display: none;">
                <h2 class="mb-4">Transfer Credits</h2>
                <form id="transaction-form">
                    <div class="mb-3">
                        <label for="seller-code" class="form-label">Seller's Unique Code</label>
                        <input type="text" class="form-control" id="seller-code" placeholder="Sender's company code"
                            required>
                    </div>
                    <div class="mb-3">
                        <label for="buyer-code" class="form-label">Buyer's Unique Code</label>
                        <input type="text" class="form-control" id="buyer-code" placeholder="Recipient's company code"
                            required>
                    </div>
                    <div class="mb-4">
                        <label for="credit-amount" class="form-label">Credits to Transfer</label>
                        <input type="number" step="0.01" class="form-control" id="credit-amount"
                            placeholder="Enter amount" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-send-fill me-2"></i> Initiate Transaction
                    </button>
                </form>
                <p id="transaction-message" class="text-center mt-3" style="display: none;"></p>
            </div>

            <!-- Transaction History Page -->
            <div id="transaction-history-page" class="content-page" style="display: none;">
                <h2 class="mb-4">Transaction History</h2>
                <div id="transaction-history-list" class="history-list-container"></div>
                <p id="transaction-history-message" class="text-center text-muted mt-3" style="display: none;">No
                    transactions found.</p>
            </div>

            <!-- Plantation Data Page -->
            <div id="verified-data-page" class="content-page" style="display: none;">
                <h2 class="mb-4">Plantation Data Ledger</h2>

                <form id="verified-data-form" class="mb-5">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="project-name" class="form-label">Project Name</label>
                            <input type="text" class="form-control" id="project-name"
                                placeholder="e.g., Odisha Reforestation" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="project-location" class="form-label">Location</label>
                            <input type="text" class="form-control" id="project-location" placeholder="e.g., India"
                                required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="trees-planted" class="form-label">Trees Planted</label>
                            <input type="number" class="form-control" id="trees-planted" placeholder="e.g., 5000"
                                required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="verification-date" class="form-label">Verification Date</label>
                            <input type="date" class="form-control" id="verification-date" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 mt-3">
                        <i class="bi bi-database-add me-2"></i> Save Record to Ledger
                    </button>
                </form>

                <hr>

                <h3 class="mt-5 mb-3">Stored Records</h3>

                <div class="card bg-light border-0 shadow-sm mb-4">
                    <div class="card-body p-4 text-center">
                        <h6 class="card-title text-muted mb-2">TOTAL ESTIMATED ANNUAL OXYGEN PRODUCTION</h6>
                        <p id="total-oxygen-production" class="display-5 fw-bold" style="color: var(--success-color);">0
                            kg/year</p>
                    </div>
                </div>

                <div id="verified-data-list" class="history-list-container"></div>
                <p id="verified-data-message" class="text-center text-muted mt-3" style="display: none;">No verified
                    data records found.</p>
            </div>

        </main>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <!-- Ethers.js -->
    <script src="https://unpkg.com/ethers@5.7.0/dist/ethers.umd.min.js"></script>

    <!-- App modules — order matters: config → lib → main -->
    <script src="config/constants.js"></script>
    <script src="lib/storage.js"></script>
    <script src="lib/calculator.js"></script>
    <script src="lib/ui.js"></script>
    <script src="assets/js/script.js"></script>
</body>

</html>